:root {
    /* Paleta */
    --bb-black: #070505;
    --bb-maroon: #7F0000;
    --bb-black-2: #010100;
    --bb-snow: #FAFAFA;
    --bb-lava: #740000;

    /* variáveis funcionais */
    --bg-color: var(--bb-black-2);
    --card-bg: var(--bb-black);
    
    /* Cores de Destaque */
    --accent-main: var(--bb-snow);    /* Texto principal e bordas neutras */
    --accent-blood: var(--bb-maroon); /* Destaque, HP, Combate */
    --accent-danger: var(--bb-lava);  /* Inimigos, Cooldowns */
    --accent-soul: #a4b0be;           /* XP / Alma (Cinza azulado pálido para contraste) */
    
    --text-color: var(--bb-snow);
    
    /* Cores de Raridade (Mantidas mas ajustadas para ficarem menos neon) */
    --rarity-common: #2ecc71;
    --rarity-rare: #3498db;
    --rarity-epic: #9b59b6;
    --rarity-legendary: #e67e22;

    /* Novas Fontes */    
    --font-title: 'Cinzel', serif;       /* Títulos, HP, Dano */
    --font-body: 'Crimson Pro', serif;   /* Logs, Descrições */
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    background-color: #000;
    color: var(--text-color);
    font-family: var(--font-body); 
    font-size: 16px; 
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* Container Principal */
.main-container {
    width: 100%;
    max-width: 1024px;
    height: 95vh;
    background-color: var(--bg-color);
    border: 2px solid #333;
    border-radius: 4px; /* Bordas menos arredondadas (mais rústico) */
    display: flex;
    flex-direction: column;
    flex-direction: row; /* Muda layout para ter lateral */
    flex-wrap: wrap;     /* Permite que o footer desça */
    box-shadow: 0 0 50px rgba(0,0,0,0.9);
    position: relative;
    overflow: hidden;
}

/* Ajuste do Palco para dividir espaço */
#stage {
    flex: 3; /* Ocupa 75% */
    border-right: 1px solid #333;
}

.brain-panel {
    flex: 1; /* Ocupa 25% */
    background: #050508;
    display: flex;
    flex-direction: column;
    padding: 10px;
    border-left: 1px solid #333;
    overflow: hidden;
    min-width: 250px;
}

.brain-header, .monitor-header {
    font-family: var(--font-title);
    color: var(--accent-soul);
    font-size: 10px;
    border-bottom: 1px solid #333;
    margin-bottom: 10px;
    padding-bottom: 2px;
    letter-spacing: 2px;
}

/* Canvas da Rede */
#neural-net-canvas {
    width: 100%;
    background: #000;
    border: 1px solid #222;
    border-radius: 4px;
    margin-bottom: 5px;
}

.output-labels {
    display: flex;
    justify-content: space-between;
    font-family: monospace;
    font-size: 9px;
    color: #555;
    padding: 0 10px;
    margin-bottom: 15px;
}

/* Grid de Estados Brutos */
.state-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr); /* 6 colunas */
    gap: 3px;
}

.state-cell {
    height: 8px;
    background: #111;
    border: 1px solid #333;
    transition: background 0.1s;
}

/* Cores de ativação dos estados */
.state-active-pos { background: var(--accent-blood); box-shadow: 0 0 5px var(--accent-blood); }
.state-active-neg { background: #2980b9; } /* Azul para valores negativos */

/* Ajuste no Header e Footer para ocuparem 100% */
header, footer, .controls { width: 100%; }

/* HEADER */
header {
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid #333;
    background: var(--bb-black);
}
h1 { 
    font-family: var(--font-title);
    font-weight: 700;
    font-size: 18px; 
    color: var(--accent-blood);
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    letter-spacing: 2px;
    border-bottom: 1px solid #333; /* Linha fina embaixo do título */
    padding-bottom: 5px;
}
.highlight { color: var(--accent-main); font-weight: bold; font-family: monospace; }

/* PALCO (MAIN) */
#stage {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    padding: 20px;
    background: radial-gradient(circle at center, #111 0%, #000 100%); /* Vinheta sutil */
}

/* Título da sala atual */
.room-title-display {
    font-family: var(--font-title);
    color: var(--bb-snow);
    font-size: 16px;
    margin-bottom: 25px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 3px; /* Bem espaçado */
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
    border-bottom: 1px solid var(--accent-blood);
    padding-bottom: 8px;
    display: inline-block;
}

/* Cena de exploração */
.exploration-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
    width: 100%;
}

.row-tier {
    display: flex;
    gap: 20px;
    justify-content: center;
    position: relative;
}

/* Linhas de conexão (Estilo Gótico - Finas e Escuras) */
.row-tier::after {
    content: '';
    position: absolute;
    bottom: -15px;
    width: 1px;
    height: 15px;
    background: #444;
}
.row-tier:last-child::after { display: none; }

.room-card {
    width: 120px;
    height: 120px;
    background: var(--card-bg);
    border: 1px solid #444; /* Borda padrão discreta */
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.8);
    transition: transform 0.2s, border-color 0.2s;
    position: relative;
}

.room-card:hover { transform: translateY(-2px); border-color: var(--accent-main); }
.room-icon { font-size: 32px; margin-bottom: 10px; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.8)); }
.room-label { font-size: 10px; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; color: #888; }

/* Estilos de Cartas */
.card-hidden {
    opacity: 0.3;
    transform: scale(0.9);
    border-color: #222;
    background: #050505;
}

/* Destaque para o Agente */
.card-agent {
    border-color: var(--accent-main);
    box-shadow: 0 0 15px rgba(250, 250, 250, 0.1);
}

/* Carta Selecionada (Caminho Escolhido) */
.room-card.selected {
    border-color: var(--accent-blood); /* Borda Vermelha */
    box-shadow: 0 0 20px rgba(127, 0, 0, 0.4); /* Glow Vermelho */
    transform: scale(1.1) translateY(-10px);
    z-index: 10;
    background: #0f0505; /* Levemente avermelhado */
}

.selection-indicator {
    position: absolute;
    bottom: -25px;        
    padding: 3px 8px;
    border-radius: 2px;    
    font-weight: bold;    
    text-transform: uppercase;
    box-shadow: 0 2px 5px rgba(0,0,0,1);
    animation: fade-up 0.3s ease-out;    
    font-family: var(--font-title);
    letter-spacing: 1px;
    font-size: 9px;
    background: var(--accent-blood);
    color: #fff;
    border: 1px solid #000;
}

/* Container de icones dentro do card */
.card-icons-container {
    display: flex;
    gap: 8px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 5px;
    height: 50px;
}
.mini-icon { font-size: 24px; }

/* Cores dos icones */
.skull-blue { color: #5dade2; filter: drop-shadow(0 0 2px rgba(0,0,0,0.8)); } /* Comum */
.skull-red { color: var(--accent-blood); filter: drop-shadow(0 0 5px rgba(127,0,0,0.8)); animation: pulse-red 2s infinite; } /* Chefe */
.skull-yellow { color: #f1c40f; text-shadow: 0 0 5px #d35400; animation: glow-pulse 1.5s infinite alternate; } /* Elite */

.icon-event { color: #9b59b6; }
.icon-effect { color: #1abc9c; }
.icon-door { color: var(--bb-snow); }
.icon-unknown { color: #444; }
.icon-agent { color: var(--bb-snow); }

/* Cena de combate */
.combat-scene {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 60px;
    width: 100%;
    height: 100%;
    position: relative;
}

.combatant {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
    width: 180px;
    position: relative;
}

.combatant img {
    width: 180px;
    height: 180px;
    object-fit: contain;
    filter: drop-shadow(0 5px 10px rgba(0,0,0,0.8)); /* Sombra mais pesada */
    margin-bottom: 10px;
}

/* Barra de Vida Inimigo */
.enemy-stats {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.enemy-bar-bg {
    width: 100%;
    height: 6px;
    background: #222;
    border: 1px solid #444;
    border-radius: 0; /* Barra quadrada */
    overflow: hidden;
    margin: 4px 0;
}
.enemy-bar-fill {
    height: 100%;
    background: var(--accent-danger); /* Molten Lava */
    transition: width 0.3s ease;
}
.enemy-name {
    color: var(--accent-danger);
    font-weight: bold;            
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    font-family: var(--font-title);
    letter-spacing: 1px;
    font-size: 13px;
    text-shadow: 2px 2px 4px #000;
}
.enemy-hp-text { font-size: 9px; color: #888; font-family: monospace; }

.vs-text {
    font-family: var(--font-title);
    font-size: 32px; /* Maior e mais fino */
    font-weight: 400;
    color: var(--accent-blood);
    margin-top: -30px;
    opacity: 0.8;
    font-style: italic; /* Estilo clássico */
}

/* Badge de Efeito (Combate) */
.combat-effect-badge {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: rgba(7, 5, 5, 0.95); /* BB Black */
    border: 1px solid #444;
    border-right: 4px solid #444;
    border-radius: 2px;
    padding: 10px 12px;
    max-width: 220px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    box-shadow: -5px 5px 20px rgba(0,0,0,1);
    z-index: 100;
    opacity: 1; transform: translateX(0);
}
.combat-effect-badge.anim-enter { animation: slide-in-right 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

.effect-header { 
    font-family: var(--font-title); 
    letter-spacing: 1px; 
    font-weight: 700;
}
.effect-desc { 
    font-family: var(--font-body); 
    font-size: 12px; 
}

/* Tipos de Efeito (Cores) */
.effect-debuff { border-right-color: var(--accent-danger); }
.effect-debuff .effect-header { color: var(--accent-danger); }
.effect-buff { border-right-color: #2ecc71; }
.effect-buff .effect-header { color: #2ecc71; }
.effect-neutral { border-right-color: #a4b0be; }
.effect-neutral .effect-header { color: #a4b0be; }

/* Container do Santuário */
.sanctuary-container {
    width: 360px;
    height: 360px;
    position: relative;
    margin: 0 auto;
    background: #050505;
    border: 2px solid #333;
    border-radius: 4px;
    box-shadow: inset 0 0 80px rgba(0,0,0,1);
}
.sanctuary-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
.connection-line { stroke: #333; stroke-width: 2; stroke-linecap: square; transition: stroke 0.3s; }
.connection-line.active { stroke: var(--accent-blood); stroke-width: 3; filter: drop-shadow(0 0 3px var(--accent-blood)); } /* Linhas de sangue */
.sanctuary-grid {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
    z-index: 2; padding: 20px;
}
.k-node { display: flex; justify-content: center; align-items: center; position: relative; }
.k-room-floor {
    width: 70px; height: 70px;
    background: #0a0a0a;
    border: 1px solid #333;
    border-radius: 4px;
    display: flex; justify-content: center; align-items: center; position: relative; transition: all 0.3s;
}
.k-node.has-agent .k-room-floor { border-color: var(--bb-snow); box-shadow: 0 0 10px rgba(255,255,255,0.1); }
.k-node.has-exit .k-room-floor { border-color: var(--rarity-legendary); box-shadow: 0 0 20px var(--rarity-legendary); animation: glow-pulse 2s infinite; }
.k-avatar { width: 65px; height: 65px; border-radius: 50%; border: 2px solid #fff; position: absolute; z-index: 10; transition: all 0.3s ease; box-shadow: 0 0 5px #000; }

/* HUD / FOOTER */
footer {
    height: 160px;
    background: var(--bb-black);
    border-top: 1px solid #333;
    display: flex;
    padding: 10px 20px;
    gap: 20px;
}

/* Avatar e Barras */
.agent-panel { flex: 2; display: flex; gap: 15px; align-items: center; }
#agent-avatar {
    width: 80px; height: 80px;
    border-radius: 4px; /* Retrato quadrado combina mais */
    border: 2px solid #444;
    margin-right: 15px;
    background: #000;
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
}

.stats-bars { flex: 1; display: flex; flex-direction: column; gap: 8px; }
.stat-row { display: flex; align-items: center; gap: 10px; }
.bar-container { flex: 1; height: 14px; background: #222; border: 1px solid #444; border-radius: 2px; overflow: hidden; position: relative; }
.bar-fill { height: 100%; transition: width 0.3s ease; }

/* Cores das barras principais */
.hp-fill { background: var(--accent-blood); } /* Maroon */
.xp-fill { background: var(--accent-soul); }  /* Cinza/Azul pálido */

.bar-text { 
    font-family: var(--font-title); 
    font-weight: 700; 
    letter-spacing: 1px; 
    font-size: 10px;
}

/* Inventário */
.inventory-row { display: flex; align-items: flex-end; gap: 15px; margin-top: 5px; }
.equipment-group, .skills-group { display: flex; flex-direction: column; gap: 4px; }
.label-tiny { 
    font-size: 10px; 
    color: #888; 
    font-weight: 700; 
    letter-spacing: 1px; 
    font-family: var(--font-title); /* Cinzel fica ótimo em caps */
    text-transform: uppercase;
}
.inventory-divider { width: 1px; height: 30px; background: #333; margin-bottom: 2px; }

.equipment-container, .skills-container { display: flex; gap: 8px; margin: 0; padding: 0; }

.equip-slot, .skill-slot {
    width: 32px; height: 32px; box-sizing: border-box;
    background: #111;
    border: 1px solid #333; /* Borda escura padrão */
    border-radius: 2px; /* Cantos retos */
    display: flex; align-items: center; justify-content: center;
    color: #444; font-size: 14px; transition: all 0.3s ease; position: relative;
}
.equip-slot.equipped { color: #ddd; background: #1a1a1a; }

/* Cores de Raridade (Bordas) */
.border-common { border-color: var(--rarity-common); }
.border-rare { border-color: var(--rarity-rare); }
.border-epic { border-color: var(--rarity-epic); }
.border-legendary { border-color: var(--rarity-legendary); box-shadow: 0 0 5px var(--rarity-legendary); }

/* Skills */
.skill-slot { overflow: hidden; }
#skill-0 { color: #f1c40f; } #skill-1 { color: #e74c3c; } #skill-2 { color: #3498db; } #skill-3 { color: #95a5a6; }

/* Cooldown (Molten Lava Overlay) */
.cd-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(116, 0, 0, 0.85); /* Molten Lava Transparente */
    color: #fff; font-weight: bold; font-size: 16px;
    display: flex; align-items: center; justify-content: center;
    text-shadow: 1px 1px 0 #000; font-family: 'Press Start 2P';
    opacity: 0; transition: opacity 0.2s; pointer-events: none;
}
.skill-slot.on-cooldown { border-color: var(--accent-danger); }
.skill-slot.on-cooldown .cd-overlay { opacity: 1; }

/* Karma */
.karma-panel { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; color: #666; font-family: 'Press Start 2P'; gap: 5px; }
#karma-disk { background: #111; border-radius: 50%; border: 1px solid #333; }

/* Logs */
.log-panel {
    font-family: var(--font-body); /* Crimson Pro */
    font-size: 14px; /* Aumenta um pouco para leitura confortável */
    line-height: 1.4;
    font-style: italic; /* Dá um tom de narrativa */
    color: #ccc;
}
.log-entry {
    margin-bottom: 4px;
    border-bottom: 1px solid #111;
    padding-bottom: 2px;
}
/* Destaque a primeira linha do log ou timestamps se houver */
.log-entry::first-letter {
    text-transform: uppercase;
    color: var(--accent-blood);
}

/* Controles */
.controls {
    position: relative; bottom: auto; margin-top: auto;
    background: var(--bb-black);
    border-top: 1px solid #333;    
    z-index: 10;
    width: 100%; /* Garante que use a largura toda do pai */
    box-sizing: border-box; /* Garante que o padding não estoure a largura */
    display: flex;
    align-items: center;
    justify-content: space-between; /* Distribui melhor */
    gap: 10px;
    padding: 10px 20px;
}
.controls button {
    background: #111; border: 1px solid #444; color: #888;
    width: 35px; height: 35px;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; border-radius: 2px;
    font-family: var(--font-title);
    font-weight: 700;
    flex-shrink: 0;
}
.controls button:hover { background: #222; color: var(--bb-snow); border-color: var(--bb-snow); }
.controls button:active { transform: scale(0.95); background: var(--accent-blood); border-color: var(--accent-blood); }

input[type=range] {
    /* Ocupa todo o espaço sobrando, mas NUNCA fica menor que 150px */
    flex: 1; 
    min-width: 150px; 
    width: auto; /* Reseta larguras fixas se houver */    
    height: 6px;
    background: #333;
    border-radius: 3px;
    appearance: none;
    cursor: pointer;
    accent-color: var(--accent-blood);
    margin: 0 10px; /* Dá um respiro lateral extra */
}
.speed-control { width: 45px !important; font-size: 10px; color: var(--accent-soul) !important; border-color: var(--accent-soul) !important; }
.speed-control:hover { background: var(--accent-soul) !important; color: #000 !important; }

/* Animações de combate */

.shake {
    animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
}

/* Durante o shake, aplicamos um filtro vermelho na imagem dentro do combatente */
.shake img {
    animation: damage-flash 0.5s ease-out;
}

/* O Tremor */
@keyframes shake {
    10%, 90% { transform: translate3d(-2px, 0, 0); }
    20%, 80% { transform: translate3d(4px, 0, 0); }
    30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
    40%, 60% { transform: translate3d(6px, 0, 0); }
}

/* O Flash Vermelho */
@keyframes damage-flash {
    0% { filter: sepia(1) hue-rotate(-50deg) saturate(5) drop-shadow(0 0 20px red); }
    100% { filter: none; } /* Volta ao normal (drop-shadow padrão do estilo) */
}

@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
@keyframes pulse-red { 0% { transform: scale(1); } 50% { transform: scale(1.1); filter: drop-shadow(0 0 15px red); } 100% { transform: scale(1); } }
@keyframes glow-pulse { from { text-shadow: 0 0 5px #d35400; transform: scale(1); } to { text-shadow: 0 0 15px #e67e22; transform: scale(1.05); } }
@keyframes slide-in-right { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
@keyframes fade-up { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }